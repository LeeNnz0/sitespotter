<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Trip Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Project Trip Tracker</h1>
            <p class="text-gray-600">Track your projects with location, spotter, and trip details</p>
        </div>
        
        <!-- Add New Project Form -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8 border border-gray-100">
            <h2 class="text-xl font-semibold text-gray-700 mb-6 flex items-center">
                <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                </svg>
                Add New Project
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                    <input type="text" id="locationInput" placeholder="Enter location" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Spotter</label>
                    <input type="text" id="spotterInput" placeholder="Enter spotter name" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                    <input type="date" id="dateInput" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Time</label>
                    <input type="time" id="timeInput" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Number of Trips</label>
                    <div class="relative">
                        <select id="tripsSelect" onchange="handleTripsChange()" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Select trips</option>
                            <option value="1-pending">1 trip (Pending)</option>
                            <option value="2-pending">2 trips (Pending)</option>
                            <option value="3-pending">3 trips (Pending)</option>
                            <option value="4-pending">4 trips (Pending)</option>
                            <option value="5-pending">5 trips (Pending)</option>
                            <option value="6-pending">6 trips (Pending)</option>
                            <option value="7-pending">7 trips (Pending)</option>
                            <option value="8-pending">8 trips (Pending)</option>
                            <option value="9-pending">9 trips (Pending)</option>
                            <option value="10-pending">10 trips (Pending)</option>
                            <option value="15-pending">15 trips (Pending)</option>
                            <option value="20-pending">20 trips (Pending)</option>
                            <option value="custom-pending">Custom number (Pending)...</option>
                        </select>
                        <input type="number" id="customTripsInput" placeholder="Enter custom number" min="1" max="999" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent mt-2 hidden">
                    </div>
                </div>
            </div>
            <div class="flex gap-3">
                <button onclick="addProject()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors flex items-center justify-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                    Add Project
                </button>
                <button onclick="exportToExcel()" class="bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-lg transition-colors flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    Export Excel
                </button>
                <button onclick="generateShareableLink()" class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-3 px-6 rounded-lg transition-colors flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
                    </svg>
                    Share Link
                </button>
            </div>
        </div>

        <!-- Projects List -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100">
            <div class="bg-gradient-to-r from-gray-50 to-blue-50 px-6 py-4 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold text-gray-700 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        Project List
                    </h2>
                    <div class="flex gap-3">
                        <span id="projectCount" class="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full">0 projects</span>
                        <span id="totalTrips" class="bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full">0 total trips</span>
                    </div>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Location</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Spotter</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Date & Day</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Time</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Trips</th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="projectsList" class="bg-white divide-y divide-gray-200">
                        <!-- Projects will be added here dynamically -->
                    </tbody>
                </table>
            </div>
            <div id="emptyState" class="text-center py-16 text-gray-500">
                <svg class="mx-auto h-16 w-16 text-gray-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                </svg>
                <h3 class="text-lg font-medium text-gray-900 mb-2">No projects yet</h3>
                <p class="text-gray-500">Add your first project using the form above!</p>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Project</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                    <input type="text" id="editLocation" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Spotter</label>
                    <input type="text" id="editSpotter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                    <input type="date" id="editDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Time</label>
                    <input type="time" id="editTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Number of Trips</label>
                    <div class="relative">
                        <select id="editTrips" onchange="handleEditTripsChange()" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="1-pending">1 trip (Pending)</option>
                            <option value="2-pending">2 trips (Pending)</option>
                            <option value="3-pending">3 trips (Pending)</option>
                            <option value="4-pending">4 trips (Pending)</option>
                            <option value="5-pending">5 trips (Pending)</option>
                            <option value="6-pending">6 trips (Pending)</option>
                            <option value="7-pending">7 trips (Pending)</option>
                            <option value="8-pending">8 trips (Pending)</option>
                            <option value="9-pending">9 trips (Pending)</option>
                            <option value="10-pending">10 trips (Pending)</option>
                            <option value="15-pending">15 trips (Pending)</option>
                            <option value="20-pending">20 trips (Pending)</option>
                            <option value="1-completed">1 trip (Completed)</option>
                            <option value="2-completed">2 trips (Completed)</option>
                            <option value="3-completed">3 trips (Completed)</option>
                            <option value="4-completed">4 trips (Completed)</option>
                            <option value="5-completed">5 trips (Completed)</option>
                            <option value="6-completed">6 trips (Completed)</option>
                            <option value="7-completed">7 trips (Completed)</option>
                            <option value="8-completed">8 trips (Completed)</option>
                            <option value="9-completed">9 trips (Completed)</option>
                            <option value="10-completed">10 trips (Completed)</option>
                            <option value="15-completed">15 trips (Completed)</option>
                            <option value="20-completed">20 trips (Completed)</option>
                            <option value="custom-pending">Custom number (Pending)...</option>
                            <option value="custom-completed">Custom number (Completed)...</option>
                        </select>
                        <input type="number" id="editCustomTripsInput" placeholder="Enter custom number" min="1" max="999" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mt-2 hidden">
                    </div>
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button onclick="saveEdit()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    Save Changes
                </button>
                <button onclick="closeEditModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 font-medium py-2 px-4 rounded-lg transition-colors">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script>
        let projects = [];
        let editingProjectId = null;

        // Load projects from localStorage and URL on page load
        function loadProjects() {
            // First try to load from URL (for shared links)
            const urlParams = new URLSearchParams(window.location.search);
            const urlData = urlParams.get('data');
            
            if (urlData) {
                try {
                    const decodedData = atob(urlData);
                    const sharedProjects = JSON.parse(decodedData);
                    
                    // Use the shared data exactly as is
                    projects = sharedProjects;
                    
                    // Save to localStorage for future use
                    localStorage.setItem('projectTripTracker', JSON.stringify(projects));
                    renderProjects();
                    
                    // Show notification that data was loaded from shared link
                    setTimeout(() => {
                        alert('Data loaded from shared link! You now have access to all the shared projects.');
                    }, 500);
                    return;
                } catch (e) {
                    console.log('Invalid URL data, loading from localStorage');
                }
            }
            
            // If no URL data, load from localStorage
            const saved = localStorage.getItem('projectTripTracker');
            if (saved) {
                projects = JSON.parse(saved);
                renderProjects();
            }
        }

        // Save projects to localStorage
        function saveProjects() {
            localStorage.setItem('projectTripTracker', JSON.stringify(projects));
        }

        // Generate shareable link with data
        function generateShareableLink() {
            if (projects.length === 0) {
                alert('No projects to share');
                return;
            }
            
            const dataString = JSON.stringify(projects);
            const encodedData = btoa(dataString);
            const shareableUrl = `${window.location.origin}${window.location.pathname}?data=${encodedData}`;
            
            // Copy to clipboard
            navigator.clipboard.writeText(shareableUrl).then(() => {
                alert('Shareable link copied to clipboard! Anyone with this link can view your projects.');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = shareableUrl;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Shareable link copied to clipboard! Anyone with this link can view your projects.');
            });
        }

        function getWeekday(dateString) {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const date = new Date(dateString);
            return days[date.getDay()];
        }

        function handleTripsChange() {
            const select = document.getElementById('tripsSelect');
            const customInput = document.getElementById('customTripsInput');
            
            if (select.value === 'custom-pending') {
                customInput.classList.remove('hidden');
                customInput.focus();
            } else {
                customInput.classList.add('hidden');
                customInput.value = '';
            }
        }

        function handleEditTripsChange() {
            const select = document.getElementById('editTrips');
            const customInput = document.getElementById('editCustomTripsInput');
            
            if (select.value === 'custom-pending' || select.value === 'custom-completed') {
                customInput.classList.remove('hidden');
                customInput.focus();
            } else {
                customInput.classList.add('hidden');
                customInput.value = '';
            }
        }

        function addProject() {
            const location = document.getElementById('locationInput').value.trim();
            const spotter = document.getElementById('spotterInput').value.trim();
            const date = document.getElementById('dateInput').value;
            const time = document.getElementById('timeInput').value;
            const tripsSelect = document.getElementById('tripsSelect').value;
            const customTrips = document.getElementById('customTripsInput').value;

            let trips;
            if (tripsSelect === 'custom-pending') {
                if (!customTrips || customTrips < 1) {
                    alert('Please enter a valid custom number of trips');
                    return;
                }
                trips = { count: parseInt(customTrips), status: 'pending' };
            } else if (tripsSelect.includes('-')) {
                const [count, status] = tripsSelect.split('-');
                trips = { count: parseInt(count), status: status };
            } else {
                alert('Please select a valid trip option');
                return;
            }

            if (!location || !spotter || !date || !time || !tripsSelect) {
                alert('Please fill in all fields');
                return;
            }

            const project = {
                id: Date.now(),
                location: location,
                spotter: spotter,
                date: date,
                time: time,
                trips: trips
            };

            projects.push(project);
            saveProjects();
            renderProjects();
            clearForm();
        }

        function editProject(id) {
            const project = projects.find(p => p.id === id);
            if (!project) return;

            editingProjectId = id;
            document.getElementById('editLocation').value = project.location;
            document.getElementById('editSpotter').value = project.spotter;
            document.getElementById('editDate').value = project.date;
            document.getElementById('editTime').value = project.time;
            
            // Check if the trips value exists in the dropdown options
            const editTripsSelect = document.getElementById('editTrips');
            const editCustomInput = document.getElementById('editCustomTripsInput');
            
            if (typeof project.trips === 'object') {
                const optionValue = `${project.trips.count}-${project.trips.status}`;
                const optionExists = Array.from(editTripsSelect.options).some(option => option.value === optionValue);
                
                if (optionExists) {
                    editTripsSelect.value = optionValue;
                    editCustomInput.classList.add('hidden');
                    editCustomInput.value = '';
                } else {
                    editTripsSelect.value = `custom-${project.trips.status}`;
                    editCustomInput.classList.remove('hidden');
                    editCustomInput.value = project.trips.count;
                }
            } else {
                // Handle old format (backward compatibility)
                if (project.trips === 'pending') {
                    editTripsSelect.value = '1-pending';
                } else {
                    editTripsSelect.value = `${project.trips}-completed`;
                }
                editCustomInput.classList.add('hidden');
                editCustomInput.value = '';
            }
            
            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editModal').classList.add('flex');
        }

        function saveEdit() {
            const project = projects.find(p => p.id === editingProjectId);
            if (!project) return;

            const location = document.getElementById('editLocation').value.trim();
            const spotter = document.getElementById('editSpotter').value.trim();
            const date = document.getElementById('editDate').value;
            const time = document.getElementById('editTime').value;
            const tripsSelect = document.getElementById('editTrips').value;
            const customTrips = document.getElementById('editCustomTripsInput').value;

            let trips;
            if (tripsSelect === 'custom-pending' || tripsSelect === 'custom-completed') {
                if (!customTrips || customTrips < 1) {
                    alert('Please enter a valid custom number of trips');
                    return;
                }
                const status = tripsSelect.split('-')[1];
                trips = { count: parseInt(customTrips), status: status };
            } else if (tripsSelect.includes('-')) {
                const [count, status] = tripsSelect.split('-');
                trips = { count: parseInt(count), status: status };
            } else {
                alert('Please select a valid trip option');
                return;
            }

            if (!location || !spotter || !date || !time || !tripsSelect) {
                alert('Please fill in all fields');
                return;
            }

            project.location = location;
            project.spotter = spotter;
            project.date = date;
            project.time = time;
            project.trips = trips;

            saveProjects();
            renderProjects();
            closeEditModal();
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editModal').classList.remove('flex');
            editingProjectId = null;
        }

        function markAsComplete(id) {
            const project = projects.find(p => p.id === id);
            if (!project) return;
            
            if (typeof project.trips === 'object' && project.trips.status === 'pending') {
                project.trips.status = 'completed';
                saveProjects();
                renderProjects();
            }
        }

        function markAsPending(id) {
            const project = projects.find(p => p.id === id);
            if (!project) return;
            
            if (confirm('Mark this project as pending? This will remove the trip count.')) {
                project.trips = 'pending';
                saveProjects();
                renderProjects();
            }
        }

        function deleteProject(id) {
            if (confirm('Are you sure you want to delete this project?')) {
                projects = projects.filter(project => project.id !== id);
                saveProjects();
                renderProjects();
            }
        }

        function exportToExcel() {
            if (projects.length === 0) {
                alert('No projects to export');
                return;
            }

            const exportData = projects.map(project => ({
                'Location': project.location,
                'Spotter': project.spotter,
                'Date': new Date(project.date).toLocaleDateString(),
                'Weekday': getWeekday(project.date),
                'Time': project.time,
                'Number of Trips': typeof project.trips === 'object' ? project.trips.count : project.trips,
                'Status': typeof project.trips === 'object' ? 
                    (project.trips.status === 'pending' ? 'Pending' : 'Completed') : 
                    (project.trips === 'pending' ? 'Pending' : 'Completed')
            }));

            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Projects');
            
            const fileName = `Project_Trip_Tracker_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        function renderProjects() {
            const projectsList = document.getElementById('projectsList');
            const emptyState = document.getElementById('emptyState');
            const projectCount = document.getElementById('projectCount');
            const totalTrips = document.getElementById('totalTrips');

            // Calculate total trips (excluding pending)
            const totalTripsCount = projects.reduce((sum, project) => {
                if (typeof project.trips === 'object') {
                    return sum + (project.trips.status === 'completed' ? project.trips.count : 0);
                } else {
                    // Handle old format (backward compatibility)
                    return sum + (project.trips === 'pending' ? 0 : project.trips);
                }
            }, 0);

            projectCount.textContent = `${projects.length} project${projects.length !== 1 ? 's' : ''}`;
            totalTrips.textContent = `${totalTripsCount} total trip${totalTripsCount !== 1 ? 's' : ''}`;

            if (projects.length === 0) {
                projectsList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            
            // Sort projects by date (newest first)
            const sortedProjects = [...projects].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            projectsList.innerHTML = sortedProjects.map(project => `
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${project.location}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-600">${project.spotter}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${new Date(project.date).toLocaleDateString()}</div>
                        <div class="text-xs text-blue-600 font-medium">${getWeekday(project.date)}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-600">${project.time}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center gap-2">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                ${typeof project.trips === 'object' ? project.trips.count : project.trips} trip${(typeof project.trips === 'object' ? project.trips.count : project.trips) !== 1 ? 's' : ''}
                            </span>
                            ${typeof project.trips === 'object' && project.trips.status === 'pending' ? 
                                '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Pending</span>' :
                                typeof project.trips === 'object' && project.trips.status === 'completed' ?
                                '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">Completed</span>' :
                                ''
                            }
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex gap-2 flex-wrap">
                            ${typeof project.trips === 'object' && project.trips.status === 'pending' ? 
                                `<button onclick="markAsComplete(${project.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-lg transition-colors flex items-center text-sm">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                    </svg>
                                    Complete
                                </button>` :
                                ''
                            }
                            <button onclick="editProject(${project.id})" class="text-blue-600 hover:text-blue-900 transition-colors flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                                Edit
                            </button>
                            <button onclick="deleteProject(${project.id})" class="text-red-600 hover:text-red-900 transition-colors flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                                Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function clearForm() {
            document.getElementById('locationInput').value = '';
            document.getElementById('spotterInput').value = '';
            document.getElementById('dateInput').value = '';
            document.getElementById('timeInput').value = '';
            document.getElementById('tripsSelect').value = '';
            document.getElementById('customTripsInput').value = '';
            document.getElementById('customTripsInput').classList.add('hidden');
        }

        // Close modal when clicking outside
        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditModal();
            }
        });

        // Load projects when page loads
        window.addEventListener('load', loadProjects);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96f7e92c80bfa0c5',t:'MTc1NTI1MjcxNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
